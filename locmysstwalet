#!/bin/bash

# ==== Cáº¤U HÃŒNH VÃ NHáº¬N TIá»€N Cá»¦A Báº N (Sá»¬A á» ÄÃ‚Y) ====
MY_WALLET="0x22cBdE4c61BA69374169eB9B1a49d62Db3beCC7f"  # <-- Thay vÃ­ Metamask cá»§a báº¡n vÃ o Ä‘Ã¢y

echo "=================================================="
echo "   AUTO CONFIG MYSTERIUM NODES"
echo "   VÃ­ nháº­n tiá»n: $MY_WALLET"
echo "=================================================="

# Láº¥y danh sÃ¡ch container myst
NODES=$(docker ps --format "{{.Names}}" | grep "myst")

if [ -z "$NODES" ]; then
    echo "âŒ KhÃ´ng tÃ¬m tháº¥y container Mysterium nÃ o Ä‘ang cháº¡y."
    exit 1
fi

echo "Äang xá»­ lÃ½ cÃ¡c node..."
echo "--------------------------------------------------"
printf "%-10s | %-42s | %-10s\n" "Node" "Identity Address (Cáº§n náº¡p tiá»n vÃ o Ä‘Ã¢y)" "Tráº¡ng thÃ¡i"
echo "--------------------------------------------------"

for node in $NODES; do
    # 1. Cháº¥p nháº­n Ä‘iá»u khoáº£n (Ä‘á» phÃ²ng chÆ°a cháº¥p nháº­n)
    docker exec "$node" myst cli --agreed-terms-and-conditions >/dev/null 2>&1

    # 2. Set vÃ­ nháº­n tiá»n (Payout)
    # Lá»‡nh nÃ y set vÃ­ chÃ­nh cá»§a báº¡n lÃ m nÆ¡i nháº­n lÃ£i
    docker exec "$node" myst cli payout set "$MY_WALLET" >/dev/null 2>&1

    # 3. Láº¥y Ä‘á»‹a chá»‰ Identity cá»§a Node (Ä‘á»ƒ báº¡n náº¡p tiá»n active)
    # Lá»c láº¥y dÃ²ng chá»©a Ä‘á»‹a chá»‰ vÃ­ báº¯t Ä‘áº§u báº±ng 0x
    NODE_ADDR=$(docker exec "$node" myst cli identities list | grep -o '0x[a-fA-F0-9]\{40\}' | head -n 1)

    # 4. Kiá»ƒm tra tráº¡ng thÃ¡i Ä‘Äƒng kÃ½
    IS_REG=$(docker exec "$node" myst cli identities list | grep "Unregistered")
    
    if [ -n "$IS_REG" ]; then
        STATUS="ChÆ°a Active âŒ"
    else
        STATUS="ÄÃ£ Active âœ…"
    fi

    printf "%-10s | %-42s | %-10s\n" "$node" "$NODE_ADDR" "$STATUS"

done
echo "--------------------------------------------------"
echo "ğŸ‘‰ HÆ¯á»šNG DáºªN BÆ¯á»šC TIáº¾P THEO:"
echo "1. Copy danh sÃ¡ch 'Identity Address' á»Ÿ trÃªn."
echo "2. DÃ¹ng vÃ­ chÃ­nh cá»§a báº¡n, gá»­i khoáº£ng 0.1 - 0.2 MYST (máº¡ng Polygon) vÃ o cÃ¡c Ä‘á»‹a chá»‰ Ä‘Ã³."
echo "3. Sau khi cÃ³ tiá»n, Node sáº½ tá»± Ä‘á»™ng Ä‘Äƒng kÃ½ (hoáº·c cháº¡y lá»‡nh: docker exec <tÃªn_node> myst cli identities register)."
