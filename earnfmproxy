#!/bin/bash
set -Eeuo pipefail

IMAGE_EARNFM="earnfm/earnfm-client:latest"
TOKEN_EARNFM="50f04bbe-94d9-4f6a-82b9-b40016bd4bbb"

# TÃªn container + tuyáº¿n máº¡ng (tun1, tun2, ...)
CONTAINERS=(
  "earnfm1:tun1"
  "earnfm2:tun2"
)

# Triá»ƒn khai tá»«ng container
for pair in "${CONTAINERS[@]}"; do
  name="${pair%%:*}"
  tun="${pair#*:}"

  echo "ðŸ§ª [SETUP] XÃ³a container cÅ© $name náº¿u cÃ³..."
  docker rm -f "$name" >/dev/null 2>&1 || true

  echo "ðŸš€ [RUN] Khá»Ÿi cháº¡y $name qua tuyáº¿n máº¡ng $tun ..."
  docker run -d --restart=always \
    --network=container:"$tun" \
    -e EARNFM_TOKEN="$TOKEN_EARNFM" \
    --name "$name" \
    "$IMAGE_EARNFM"
done

echo ""
echo "âœ… HoÃ n táº¥t! CÃ¡c container EarnFM Ä‘Ã£ Ä‘Æ°á»£c khá»Ÿi cháº¡y:"
docker ps --filter "ancestor=$IMAGE_EARNFM" --format "table {{.Names}}\t{{.Status}}\t{{.Networks}}"

echo ""
echo "ðŸ“¡ Gá»£i Ã½ kiá»ƒm tra IP tá»«ng tuyáº¿n:"
for pair in "${CONTAINERS[@]}"; do
  tun="${pair#*:}"
  echo "  docker run --rm --network=container:$tun curlimages/curl:latest -s ifconfig.me"
done
